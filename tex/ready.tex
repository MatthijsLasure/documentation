% Getting ready: preparations
Before the actual simulation can start, some preparations have to be performed.
This consists of preparing the solute, the box and performing a minimization 
using Lennard-Jones. Finally, the box is rescaled to reflect the correct 
density.

\section{IMPORTANT NOTES}
\subsection{Floating Point Values}
If the program expects a floating point value but an integer is given (because 
the value happens to be round), it will be incorrectly read. Always make sure 
there is a point.

So not: \verb|  8   1 60| (for solute rotation)

But do: \verb|  8   1 60.0|

Wrong: \textvisiblespace\textvisiblespace 8 
\textvisiblespace\textvisiblespace\textvisiblespace 1 \textvisiblespace 60

\texttt{\char32}

\subsection{End Of File}
Fortran expects an empty line at the end of the file. Not complying will result 
in an incorrect read. This is very important when preparing data on a Windows 
machine. It is also advised to use the \verb|dos2unix| and \verb|checknprep| 
(included in the download) utilities to ensure correct conventions.

\section{Box preparation}
For smaller molecules ($N < 25$), the included box can be used. It contains 30 
DMSO molecules (random placed and rotated) in a \SI{20}{\angstrom} sided box.
To generate a new box, it generally suffices to generate 6 random values per 
DMSO molecule, where the first 3 represent the position of the Centre of Mass 
(CoM), and the latter are the angles of rotation. The coordinates are relative 
to the middle of the box, so they will be in $[-r/2, +r/2]$. The angles lie in 
$[-\pi, +\pi]$. Use following syntax:

\begin{enumerate}
	\item The half length of the edge of the box, in angstrom ($r/2$);
	\item Number of DMSO molecules;
	\item The energy of the box (see note);
	\item The coordinates and angles of all molecules, one per line (X Y Z 
	$\alpha$ $\beta$ $\gamma$);
	\item A line that says \verb|SOLUTE|;
	\item The solute (see next section).
\end{enumerate}

Note: the energy of the box will be calculated during the simulation when QM 
calculations are performed (see Getting Started). When starting with 
minimisations it is sufficient to set it to $0.0$.

\section{Solute preparation}
This section can be performed with a program of choice that can handle 
molecules, such as ADF, Gaussian or Chem3D. Draw the molecule and use a quick 
minimize (if available). Afterwards, perform a good optimisation to get a good 
structure. Good results have been achieved using Gaussian and the B3LYP/6-31G* 
potential-base set combination.
When finished, obtain the cartesian coordinates from the output. Perform a PM6 
single point calculation, and obtain the energy in Hartree.

 Open the box file, and look for the line that says \verb|SOLUTE|. After this 
 line, write the following:

\begin{enumerate}
	\item The number of solute atoms;
	\item A description of the solute (e.g. name);
	\item All atom symbols and coordinates, one line per atom;
	\item The energy in Hartree;
	\item The number of bonds used for internal rotation;
	\item A list of bonds used for rotation (see below);
	\item An empty line.
\end{enumerate}

\subsection{Bonds for rotation}
The syntax for this list is unfortunately very picky due to programming 
limitations. 

\verb|III_III_FFFFFF|

With III being the number for the atoms of the bond. Notice that one integer 
MUST occupy 3 characters. The underscore is a character that will be ignored 
(it is recommended to use a space), 
and FFFFF is a floating point value, that is used to indicate an individual 
maximal rotation, overriding the general maximal rotation. This is optional.

In short, writing the following will result in unexpected results:

\verb|8 1| will read in as $(81, 0)$ instead of $(8, 1)$. Rather use 
\verb|008 001| that will yield correct results.

\begin{lstlisting}[caption=Example of a correct box-file]
7.7838685667999998     
30
-796.46817126240921     
BOX 9
-4.93  6.07  2.42 -2.07 -1.17   1.32     
4.66 -1.67  6.16  2.76  2.64  -1.68     
...     
SOLUTE
11
Solute: (R)-2-Chloropropanoic acid
C  0.30  0.37 -0.51
H  0.50 -0.02 -1.51
Cl 1.54 -0.39  0.57
C  0.42  1.89 -0.48
H -0.31  2.33 -1.15
H  0.25  2.27  0.52
H  1.42  2.19 -0.81
C -1.08 -0.12 -0.12
O -2.09  0.12 -0.73
O -1.05 -0.85  1.01
H -1.97 -1.13  1.18
-0.16947515     
1
8   1  60.000000

\end{lstlisting}

It cannot be stressed enough that there MUST be an empty line at the end of the 
file to ensure correct reading of the data.

\section{Minimisation theory}
In the run script, there is a section for the minimisation, between the 
\verb|if false; then| en \verb|fi| statements. To run both the minimisation and 
the simulation, change the \verb|false| to \verb|true|. If you only want to run 
the minimisation, copy the first section (until the \verb|fi|) to a seperate 
run script.

The run script will perform 4 Lennard-Jones simulations with 1 million steps 
each. In between simulations the box is rescaled.

The density of the box can be calculated using formula~\ref{eqn:density}. If 
assumed that the solute is of equal volume as a DMSO molecule (which is the 
case for e.g. chloropropanoic acid), n is 31 and the density is $0,5027 
\textrm{ g cm}^{-3}$. After a rescaling the correct edge length is obtained to 
get the density of $1,09037 \textrm{ g cm}^{-3}$.\cite{Radhamma2008}
The process is done in multiple steps to allow the system to relax so no 
molecules are clipping into each other.

\begin{equation} \label{eqn:density}
\rho = \dfrac{n}{(r \si{\angstrom})^3} = \dfrac{n}{(r \si{\cdot 10^{-7} cm})^3} 
=
\dfrac{n}{(r \cdot 10^{-7})^3} \cdot \dfrac{M_{DMSO}}{N_A} \dfrac{g}{cm^3}
\end{equation}

After the LJ simulations, a long QM simulation is run to ensure the box is well 
optimized.

In the config file, the parameters have been set to not rotate the solute (as 
this is not the actual simulation). As explained in section XX, the number of 
steps for LJ and GA are ignored as they are passed via command line arguments.

\subsection{Minimisation}\label{subs:minimisation}
When you are ready to start, run following command:

\begin{lstlisting}[caption=runmin]
./run.sh &> log.txt
\end{lstlisting}

By using \verb|&> log.txt|, all messages are written to log.txt.

It is important to note where to run the command. The program will be 
terminated when the shell is closed. This can occur in a SSH session due to 
network issues or other problems. Thereby you can use for example \verb|byobu|, 
which will create a shell that will remain open, even when the calling shell is 
closed. Open an existing session with \verb|byobu|, or open a new one with 
\verb|byobu new|. You can detach from a byobu shell by pressing CTRL-A and then 
CTRL-D.