% !TeX spellcheck = en_GB
\documentclass[a4paper,fleqn]{report}

\usepackage{docStyle}


\lstset{language=Bash} 

\begin{document}
	
	\chapter{User's manual}

	
	This document will explain the steps needed to obtain a successfull VCD-spectrum using the DMSO Monte-Carlo simulation.
	
	Following steps are neccesary:
	\begin{enumerate}
		\setlength{\itemsep}{-1pt}
		\setlength{\parsep}{-1pt}
		\item Installation of neccesary programs and configuration
		\item Preparation of the simulation
		\item Minimization and density control
		\item Simulation
		\item Checks of the results
		\item Processing of the results for QM calculations
		\item Spectra calculations
		\item Final spectrum
	\end{enumerate}
	
	\section{Environment preparation}
	
	\subsection{External programs}
	In order to run, both Gaussian 09\cite{g09} and MOPAC\cite{mopac} are 
	necessary. Gaussian is used 
	for the initial charge calculations, and both versions A.02 and D.01 have 
	been tested.
	MOPAC2016 is used for the PM6 energy calculations. Version 16.175L is known 
	to work.
	
	For the installation of Gaussian, please refer to the manual. As long as 
	the path is added to the \verb|PATH|-variable it should work.
	
	The installation of MOPAC is slightly more complex, as the instructions do 
	not work out of the box.
	First, follow the instructions included in the download. Make sure to 
	install the password.
	Next, add a symbolic link to the \verb|MOPAC2016.exe| executable named 
	\verb|mopac|.
	This symbolic link needs to be in a directory which is on the 
	\verb|PATH|-variable. This can be achieved by adding the 
	\verb|mopac|-directory to said variable in \verb|.bashrc|.
	
	\begin{lstlisting}[caption={Configuration},label=lst:configuration]
# in the installation directory:
ln -s MOPAC2016.exe mopac
# in .bashrc:
export PATH=$PATH:/path/to/mopac/
	\end{lstlisting}
	
	\subsection{Compilation of internal programs}
	
	\subsubsection{Compilers}
	It is recommended to compile the programs locally on the system you plan to 
	use. Binaries are available on-line, but might not work.
	
	Both the GNU Fortran compiler and the Intel iFort compiler are supported.
	
	First, obtain the latest source code from 
	\url{https://github.com/MatthijsLasure/MonteCarlo/releases} and unpack the 
	file.
	
	\subsubsection{Monte Carlo}
	Inside the MonteCarlo folder, make a folder that will contain the temporary 
	files for the compilation.
	For the Intel compiler, name the folder \verb|tmp-intel|, and for the GNU 
	compiler use \verb|tmp-GNU|.
	Finally, compile the program:
	\begin{lstlisting}[caption={Compilation of MonteCarlo},label=lst:makeGNU]
make GNU
# or
make intel
	\end{lstlisting}
	
	Note that it will default to \verb|intel| if no argument is given.
	
	The output file is called \verb|MonteCarloGNU| or \verb|MonteCarloOpenMP| 
	depending on the chosen compiler, and will have the correct permissions.
	
	\subsubsection{ConvertDump}
	In the \verb|ConvertDump| folder, just execute \verb|make|. It's that 
	simple!
	
	\subsubsection{BoxScale}
	In the \verb|BoxScale| folder, execute the following:
	\begin{lstlisting}[caption={Compilation of BoxScale}, 
	label=lst:makeBoxScale]
gfortran -o BoxScale BoxScale.f08
	\end{lstlisting}
	
	
	\section{Preparation of the simulation}
	It is advised to make a dedicated folder per simulation ran, as to avoid 
	clutter and overwriting the wrong files.
	A number of start files are necessary as listed below.
	In the tools/files folder there are example files provided that can be 
	used.
	
	\begin{itemize}
		\setlength{\itemsep}{-1pt}
		\setlength{\parsep}{-1pt}
		\item box.txt: This file contains the coordinates and angles of the 
		DMSO molecules. The example file contains a box, size 
		\SI{20}{\angstrom} and 30 DMSO molecules.
		This box has been proven usefull when calculating 
		small (10-20 atoms) molecules.
		\item DMSO.txt: In this file is the DMSO molecule defined. It is 
		already optimized and is ready to be used.
		\item par\_solute.txt: this file contain the parameters, necessary for 
		the Molecular Mechanics calculations.\cite{Robertson2015}
		\item param.txt: Same as above, but optimized for DMSO.\cite{Liu1995}
		\item solute.txt: The file containing the molecule of interest.
		\item config.ini: Configuration file
		\item run.sh: Script for running the simulation. Contains both the 
		minimization and simulation commands.
	\end{itemize}
	
	The example files are ready for use with smaller molecules.
	Bigger molecules may work, or may require redefining or resizing the box.
	
	\section{Solute preparation}
	Preparing the solute consists of a few steps.
	First, draw the solute in a program of choice to obtain the coordinates.
	Make sure that the right enantiomer is drawn. With these coordinates, 
	perform a minimisation of the solute.
	Good results were had by first using the MM2 method, build into Chem3D, 
	followed by a standard B3LYP/6-31G(d,p) optimisation in Gaussian 09.
	
	Put the resulting coordinates in a new file. At the top, add the number of 
	atoms, and a description on the second line.
	At the bottom of the file, add the number of bonds, eligible for rotation 
	and a list of said bonds.
	
	\section{Density}
	The density of DMSO is \SI{1,09037}{g cm^{-3}}.\cite{Radhamma2008}
	The correlation between density and molar mass is:
	\begin{equation}
	\rho = \dfrac{n}{(r \si{\angstrom})^3} = \dfrac{n}{(r \si{10^{-7} 
	cm})^3} = \dfrac{n M_{DMSO}}{r^3 N_A} \dfrac{10^{21} g}{cm^3}
	\end{equation}
	
	The initial box is too large to get the correct density, which will cause 
	surface interactions. This is done on purpose as to avoid any molecules 
	clipping into each other. To get to the correct density, we will use a 
	quick minimisation (MM) and the BoxScale utility to resize the box while 
	avoiding any collisions.
	Following steps will be taken to achieve a box with length 
	\SI{15,57}{\angstrom} and correct density. In this example the solute is 
	regarded as a solvent molecule since they have nearly the same volume.
	
	\begin{enumerate}
		\setlength{\itemsep}{-1pt}
		\setlength{\parsep}{-1pt}
		\item Minimisation with MM
		\item BoxScale x 0,9
		\item Minimisation with MM
		\item BoxScale x 0,9
		\item Minimisation with MM
		\item BoxScale x 0,96
		\item Minimisation with MM
		\item Minimisation with QM
	\end{enumerate}
	
	In the past, 5 million MM iterations have been used.
	Analysis shows that the energy is already converged after $10^4 - 10^5$ 
	steps.
	It is however recommended to use at least 1 million steps to ensure 
	convergence.
	
	For the QM minimisation, 25.000 steps have been used. This minimisation is 
	necessary, because of the inaccuracies of the MM method. It is advised to 
	actually perform the full 25.000 steps to ensure good results.
	
	The minimisation is included in the \verb|run.sh| script in the example 
	folder. It uses the \verb|config0.ini| file, which inhibits solute rotation.
	
	\section{Simulation}
	The simulation runs as following:
	\begin{enumerate}
		\item Program starts
		\item Solute is rotated
		\item n steps of QM are done
		\item Solute is accepted / rejected
		\item Program finishes
		\item Script starts next iteration
	\end{enumerate}
	
	

	\newpage
	\begin{spacing}{0.75}
		\addcontentsline{toc}{chapter}{Referenties}
		%\footnotesize
		\label{Referenties}
		\clearpage
		\renewcommand{\bibname}{Referenties}
		\bibliography{bachelorthesis}
	\end{spacing}
	
	
\end{document}